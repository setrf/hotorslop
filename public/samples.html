<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dataset Samples - Hot or Slop</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #2d2226;
      color: #f5f1e8;
      margin: 0;
      padding: 2rem;
    }
    h1 {
      text-align: center;
      margin-bottom: 2rem;
    }
    .section {
      margin-bottom: 3rem;
    }
    .section h2 {
      color: #ff4e00;
      border-bottom: 1px solid rgba(255,241,225,0.2);
      padding-bottom: 0.5rem;
      margin-bottom: 1rem;
    }
    .section h2.real {
      color: #4a9eff;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
    }
    .card {
      background: rgba(95, 82, 79, 0.6);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(255,241,225,0.12);
    }
    .card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
    }
    .card .info {
      padding: 0.75rem;
      font-size: 0.8rem;
    }
    .card .model {
      color: #ffd699;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    .card .prompt {
      color: rgba(255,255,255,0.7);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .loading {
      text-align: center;
      padding: 2rem;
      color: rgba(255,255,255,0.6);
    }
    .back-link {
      display: inline-block;
      margin-bottom: 1rem;
      color: #4a9eff;
      text-decoration: none;
    }
    .back-link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <a href="/" class="back-link">&larr; Back to game</a>
  <h1>Dataset Samples</h1>

  <div class="section">
    <h2>OpenFake Synthetic (AI) - imagen, gpt, flux models</h2>
    <div id="openfake-synthetic" class="grid"><div class="loading">Loading...</div></div>
  </div>

  <div class="section">
    <h2>Nano-Banana (AI) - gemini-2.5-flash</h2>
    <div id="nano-banana" class="grid"><div class="loading">Loading...</div></div>
  </div>

  <div class="section">
    <h2 class="real">COCO-Caption2017 (Real Photos)</h2>
    <div id="coco-real" class="grid"><div class="loading">Loading...</div></div>
  </div>

  <div class="section">
    <h2 class="real">OpenFake Real (Real Photos)</h2>
    <div id="openfake-real" class="grid"><div class="loading">Loading...</div></div>
  </div>

  <script>
    const HF_API = 'https://datasets-server.huggingface.co';

    const datasets = {
      'openfake-synthetic': {
        id: 'Anonymous460/OpenFake',
        config: 'default',
        split: 'test',
        filter: row => row.label === 'fake' && row.model && ['imagen', 'gpt', 'flux'].some(p => row.model.toLowerCase().startsWith(p)),
        transform: row => ({ src: row.image?.src, model: row.model, prompt: row.prompt })
      },
      'nano-banana': {
        id: 'bitmind/nano-banana',
        config: 'default',
        split: 'train',
        filter: row => row.image?.src,
        transform: row => ({ src: row.image?.src, model: 'gemini-2.5-flash', prompt: 'AI-generated image' })
      },
      'coco-real': {
        id: 'lmms-lab/COCO-Caption2017',
        config: 'default',
        split: 'val',
        filter: row => row.image?.src,
        transform: row => ({ src: row.image?.src, model: 'Real Photo', prompt: Array.isArray(row.answer) ? row.answer[0] : row.question || 'No caption' })
      },
      'openfake-real': {
        id: 'Anonymous460/OpenFake',
        config: 'default',
        split: 'test',
        filter: row => row.label === 'real' && row.image?.src,
        transform: row => ({ src: row.image?.src, model: 'Real Photo', prompt: row.prompt })
      }
    };

    async function fetchSamples(key, count = 5) {
      const ds = datasets[key];
      const container = document.getElementById(key);

      try {
        // Get random offset
        const infoUrl = `${HF_API}/info?dataset=${ds.id}&config=${ds.config}&split=${ds.split}`;
        const infoRes = await fetch(infoUrl);
        const infoData = await infoRes.json();
        const totalRows = infoData.dataset_info?.splits?.[ds.split]?.num_examples || 1000;

        // Fetch more rows to account for filtering
        const limit = count * 10;
        const offset = Math.floor(Math.random() * Math.max(totalRows - limit, 1));

        const rowsUrl = `${HF_API}/rows?dataset=${ds.id}&config=${ds.config}&split=${ds.split}&offset=${offset}&limit=${limit}`;
        const rowsRes = await fetch(rowsUrl);
        const rowsData = await rowsRes.json();

        const samples = (rowsData.rows || [])
          .map(r => r.row)
          .filter(ds.filter)
          .slice(0, count)
          .map(ds.transform);

        if (samples.length === 0) {
          container.innerHTML = '<div class="loading">No samples found</div>';
          return;
        }

        container.innerHTML = samples.map(s => `
          <div class="card">
            <img src="${s.src}" alt="" loading="lazy">
            <div class="info">
              <div class="model">${s.model || 'Unknown'}</div>
              <div class="prompt">${s.prompt || 'No description'}</div>
            </div>
          </div>
        `).join('');
      } catch (err) {
        container.innerHTML = `<div class="loading">Error: ${err.message}</div>`;
      }
    }

    // Load all samples
    Object.keys(datasets).forEach(key => fetchSamples(key, 5));
  </script>
</body>
</html>
